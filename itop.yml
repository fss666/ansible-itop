---
- name: Install iTop
  hosts: argentina.eastus.cloudapp.azure.com
  vars:
    post_max_size: 32M
    suhosin_get_max_value_length: 2048
  become: true

  tasks:
  - name: Add epel-release repo
    yum:
      name: epel-release
      state: present

  - name: Install the remi and ius repo from remote repo
    yum:
      name:
        - "http://rpms.remirepo.net/enterprise/remi-release-{{ ansible_distribution_major_version }}.rpm"
        - "https://centos{{ ansible_distribution_major_version }}.iuscommunity.org/ius-release.rpm"

  - name: Enable remi-php71 repository
    shell: yum-config-manager --enable remi-php71


  - name: Install packages using yum
    yum:
      name:
        - httpd
        - mariadb
        - mariadb-server
        - php
	- php-gd
        - php-mysql
        - php-mcrypt
        - php-xml
        - php-cli
        - php-pecl-zip
        - php-soap
        - php-ldap
        - graphviz
      state: present

  - name: Install (libsemanage-python) prereq for Ansible seboolean module
    yum:
      name: libsemanage-python
      state: present

  - name: Set SELinux for httpd
    seboolean:
      name: httpd_can_network_connect_db
      state: yes
      persistent: yes

  - name: Custom /etc/php.ini
    template:
      src: php.ini.j2
      dest: /etc/php.ini

  - name: install iTop applicaiton
    unarchive:
      src: iTop-2.5.0-3935.zip 
      dest: /var/www/html/

  - name: CHOWN and CHMOD on iTop directory
    file:
      dest: /var/www/html/web
      owner: apache
      group: apache
      mode: u=rwX,g=rX,o=rX
      recurse: yes

  - name: CHOWN and CHMOD on iTop directory
    file:
      dest: /var/www/html/web/log
      owner: apache
      group: apache
      mode: u=rwX,g=rX,o=rX
      recurse: yes

  - name: Starting service Apache
    service:
      name: httpd
      enabled: yes
      state: started

  - name: Starting service MySQL/mariaDB
    service:
      name: mariadb
      enabled: yes
      state: started


